C51 COMPILER V9.55   EEPROM                                                                04/12/2020 17:13:52 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN c:\Users\Administrator\Documents\Source\MCU\bujin\.\out\EEPROM.obj
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.exe c:\Users\Administrator\Documents\Source\MCU\bujin\.\dependence\build-in\
                    -STD\EEPROM.c LARGE OMF2 ROM(LARGE) OPTIMIZE(8,SPEED) REGFILE(c:\Users\Administrator\Documents\Source\MCU\bujin\.\out\mai
                    -n.ORC) INCDIR(c:\Users\Administrator\Documents\Source\MCU\bujin\.\dependence;c:\Users\Administrator\Documents\Source\MCU
                    -\bujin\.\dependence\build-in;c:\Users\Administrator\Documents\Source\MCU\bujin\.\dependence\build-in\STD;c:\Keil_v5\C51\
                    -INC) PRINT(c:\Users\Administrator\Documents\Source\MCU\bujin\.\out\EEPROM.lst) TABS(2) OBJECT(c:\Users\Administrator\Doc
                    -uments\Source\MCU\bujin\.\out\EEPROM.obj)

line level    source

   1          
   2          //  æœ¬ç¨‹åºæ˜¯STCç³»åˆ—çš„å†…ç½®EEPROMè¯»å†™ç¨‹åºã€‚
   3          
   4          #include "C:\Users\Administrator\Documents\Source\MCU\bujin\dependence\build-in\STD\config.h"
   5          #include "C:\Users\Administrator\Documents\Source\MCU\bujin\dependence\build-in\STD\eeprom.h"
   6          #include <C:\Keil_v5\C51\INC\intrins.h>
   7          
   8          
   9          //========================================================================
  10          // å‡½æ•°: void ISP_Disable(void)
  11          // æè¿°: ç¦æ­¢è®¿é—®ISP/IAP.
  12          // å‚æ•°: non.
  13          // è¿”å›: non.
  14          // ç‰ˆæœ¬: V1.0, 2012-10-22
  15          //========================================================================
  16          void  DisableEEPROM(void)
  17          {
  18   1        ISP_CONTR = 0;      //ç¦æ­¢ISP/IAPæ“ä½œ
  19   1        ISP_CMD   = 0;      //å»é™¤ISP/IAPå‘½ä»¤
  20   1        ISP_TRIG  = 0;      //é˜²æ­¢ISP/IAPå‘½ä»¤è¯¯è§¦å‘
  21   1        ISP_ADDRH = 0xff;   //æ¸…0åœ°å€é«˜å­—èŠ‚
  22   1        ISP_ADDRL = 0xff;   //æ¸…0åœ°å€ä½å­—èŠ‚ï¼ŒæŒ‡å‘éEEPROMåŒºï¼Œé˜²æ­¢è¯¯æ“ä½œ
  23   1      }
  24          
  25          //========================================================================
  26          // å‡½æ•°: void EEPROM_read_n(u16 EE_address,u8 *DataAddress,u16 number)
  27          // æè¿°: ä»æŒ‡å®šEEPROMé¦–åœ°å€è¯»å‡ºnä¸ªå­—èŠ‚æ”¾æŒ‡å®šçš„ç¼“å†².
  28          // å‚æ•°: EE_address:  è¯»å‡ºEEPROMçš„é¦–åœ°å€.
  29          //       DataAddress: è¯»å‡ºæ•°æ®æ”¾ç¼“å†²çš„é¦–åœ°å€.
  30          //       number:      è¯»å‡ºçš„å­—èŠ‚é•¿åº¦.
  31          // è¿”å›: non.
  32          // ç‰ˆæœ¬: V1.0, 2012-10-22
  33          //========================================================================
  34          
  35          void EEPROM_read_n(u16 EE_address,u8 *DataAddress,u16 number)
  36          {
  37   1        EA = 0;   //ç¦æ­¢ä¸­æ–­
  38   1        ISP_CONTR = (IAPEN + ISP_WAIT_FREQUENCY); //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸ISP/IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
  39   1        ISP_CMD = 1;                  //é€å­—èŠ‚è¯»å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é‡æ–°é€å‘½ä»¤
  40   1        do
  41   1        {
  42   2          ISP_ADDRH = EE_address / 256;   //é€åœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°å€ï¼‰
  43   2          ISP_ADDRL = EE_address % 256;   //é€åœ°å€ä½å­—èŠ‚
  44   2          ISP_TRIG = 0x5A;          //å…ˆé€5AHï¼Œå†é€A5Håˆ°ISP/IAPè§¦å‘å¯„å­˜å™¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦å¦‚æ­¤
  45   2          ISP_TRIG = 0xA5;          //é€å®ŒA5Håï¼ŒISP/IAPå‘½ä»¤ç«‹å³è¢«è§¦å‘å¯åŠ¨
  46   2                            //CPUç­‰å¾…IAPå®Œæˆåï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œç¨‹åºã€‚
  47   2          _nop_();
  48   2          *DataAddress = ISP_DATA;      //è¯»å‡ºçš„æ•°æ®é€å¾€
  49   2          EE_address++;
  50   2          DataAddress++;
C51 COMPILER V9.55   EEPROM                                                                04/12/2020 17:13:52 PAGE 2   

  51   2        }while(--number);
  52   1      
  53   1        DisableEEPROM();
  54   1        EA = 1;   //é‡æ–°å…è®¸ä¸­æ–­
  55   1      }
  56          
  57          
  58          /******************** æ‰‡åŒºæ“¦é™¤å‡½æ•° *****************/
  59          //========================================================================
  60          // å‡½æ•°: void EEPROM_SectorErase(u16 EE_address)
  61          // æè¿°: æŠŠæŒ‡å®šåœ°å€çš„EEPROMæ‰‡åŒºæ“¦é™¤.
  62          // å‚æ•°: EE_address:  è¦æ“¦é™¤çš„æ‰‡åŒºEEPROMçš„åœ°å€.
  63          // è¿”å›: non.
  64          // ç‰ˆæœ¬: V1.0, 2013-5-10
  65          //========================================================================
  66          void EEPROM_SectorErase(u16 EE_address)
  67          {
  68   1        EA = 0;   //ç¦æ­¢ä¸­æ–­
  69   1                            //åªæœ‰æ‰‡åŒºæ“¦é™¤ï¼Œæ²¡æœ‰å­—èŠ‚æ“¦é™¤ï¼Œ512å­—èŠ‚/æ‰‡åŒºã€‚
  70   1                            //æ‰‡åŒºä¸­ä»»æ„ä¸€ä¸ªå­—èŠ‚åœ°å€éƒ½æ˜¯æ‰‡åŒºåœ°å€ã€‚
  71   1        ISP_ADDRH = EE_address / 256;     //é€æ‰‡åŒºåœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°å€ï¼
             -‰
  72   1        ISP_ADDRL = EE_address % 256;     //é€æ‰‡åŒºåœ°å€ä½å­—èŠ‚
  73   1        ISP_CONTR = (IAPEN + ISP_WAIT_FREQUENCY); //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸ISP/IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
  74   1        ISP_CMD = 3;              //é€æ‰‡åŒºæ“¦é™¤å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é‡æ–°é€å‘½ä»¤
  75   1        ISP_TRIG = 0x5A;
  76   1        ISP_TRIG = 0xA5;
  77   1        _nop_();
  78   1        DisableEEPROM();
  79   1        EA = 1;   //é‡æ–°å…è®¸ä¸­æ–­
  80   1      }
  81          
  82          //========================================================================
  83          // å‡½æ•°: void EEPROM_write_n(u16 EE_address,u8 *DataAddress,u16 number)
  84          // æè¿°: æŠŠç¼“å†²çš„nä¸ªå­—èŠ‚å†™å…¥æŒ‡å®šé¦–åœ°å€çš„EEPROM.
  85          // å‚æ•°: EE_address:  å†™å…¥EEPROMçš„é¦–åœ°å€.
  86          //       DataAddress: å†™å…¥æºæ•°æ®çš„ç¼“å†²çš„é¦–åœ°å€.
  87          //       number:      å†™å…¥çš„å­—èŠ‚é•¿åº¦.
  88          // è¿”å›: non.
  89          // ç‰ˆæœ¬: V1.0, 2012-10-22
  90          //========================================================================
  91          void EEPROM_write_n(u16 EE_address,u8 *DataAddress,u16 number)
  92          {
  93   1        EA = 0;   //ç¦æ­¢ä¸­æ–­
  94   1      
  95   1        ISP_CONTR = (IAPEN + ISP_WAIT_FREQUENCY); //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸ISP/IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
  96   1        ISP_CMD = 2;              //é€å­—èŠ‚å†™å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é‡æ–°é€å‘½ä»¤
  97   1        do
  98   1        {
  99   2          ISP_ADDRH = EE_address / 256;   //é€åœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°å€ï¼‰
 100   2          ISP_ADDRL = EE_address % 256;   //é€åœ°å€ä½å­—èŠ‚
 101   2          ISP_DATA  = *DataAddress;     //é€æ•°æ®åˆ°ISP_DATAï¼Œåªæœ‰æ•°æ®æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€
 102   2          ISP_TRIG = 0x5A;
 103   2          ISP_TRIG = 0xA5;
 104   2          _nop_();
 105   2          EE_address++;
 106   2          DataAddress++;
 107   2        }while(--number);
 108   1      
 109   1        DisableEEPROM();
 110   1        EA = 1;   //é‡æ–°å…è®¸ä¸­æ–­
 111   1      }
C51 COMPILER V9.55   EEPROM                                                                04/12/2020 17:13:52 PAGE 3   

 112          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    172    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
